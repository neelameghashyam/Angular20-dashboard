<div class="fixed bottom-6 right-6 z-50">
  <!-- Floating Icon -->
  <button
    (click)="toggleChat()"
    *ngIf="!isOpen()"
    class="fixed bottom-6 right-6 z-50 transition-transform duration-300 ease-in-out hover:scale-110"
  >
    <img src="assets/icons/chat-bot.svg" alt="Chat Bot" class="w-10 h-10" />
  </button>

  <!-- Chat Window -->
  <div
    *ngIf="isOpen()"
    [@fadeSlide]
    class="fixed bottom-6 right-6 z-50 bg-card text-card-foreground shadow-xl rounded-xl flex flex-col overflow-hidden transition-all duration-300 ease-in-out transform"
    [ngClass]="isExpanded() ? 'w-[800px] h-[400px]' : 'w-[320px] h-[400px]'"
  >
    <!-- Header -->
    <div class="flex items-center justify-between p-2 border-b border-border bg-white text-black">
      <span class="font-semibold flex items-center gap-1.5 text-s">
        <img src="assets/icons/chat-bot.svg" alt="Chat Bot" class="w-8 h-8" />
        AIRA
      </span>
      <div class="flex gap-1">
        <button (click)="expandChat()" *ngIf="!isExpanded()" >
          <span class="material-symbols-outlined text-sm">open_in_full</span>
        </button>
        <button (click)="collapseChat()" *ngIf="isExpanded()" >
          <span class="material-symbols-outlined text-sm">hide</span>
        </button>
        <button (click)="toggleChat()" >
          <span class="material-symbols-outlined text-sm">close</span>
        </button>
      </div>
    </div>

    <!-- Messages -->
    <div class="flex-1 overflow-y-auto p-2 space-y-2 scrollbar-thin scrollbar-thumb-muted scrollbar-track-transparent">
      <div *ngFor="let msg of messages()">
        <div [ngClass]="msg.sender === 'user' ? 'text-right' : 'text-left'">
          <div
            [ngClass]="msg.sender === 'user'
              ? 'inline-block bg-primary text-primary-foreground px-2 py-1 rounded-lg text-xs'
              : 'inline-block bg-muted text-muted-foreground px-2 py-1 rounded-lg text-xs'"
          >
            {{ msg.text }}
          </div>
<div *ngIf="msg.sender === 'bot' && msg.showTools" 
     class="flex gap-[2] mt-[2] text-muted-foreground">

  <button class="p-[1px] flex items-center justify-center">
    <span class="material-symbols-outlined text-[12px] leading-none scale-60">thumb_up</span>
  </button>

  <button class="p-[1px] flex items-center justify-center" (click)="thumbsDown()">
    <span class="material-symbols-outlined text-[12px] leading-none scale-60">thumb_down</span>
  </button>

  <button class="p-[1px] flex items-center justify-center" (click)="copyMessage(msg.text)">
    <span class="material-symbols-outlined text-[12px] leading-none scale-60">content_copy</span>
  </button>
</div>

        </div>
      </div>

      <!-- Typing dots -->
<div *ngIf="awaitingResponse()" class="flex items-center gap-1">
  <div class="inline-flex items-center bg-gray-200 text-gray-600 px-2 py-1 rounded-lg text-sm">
    <span class="animate-bounce text-xl mx-1">●</span>
    <span class="animate-bounce text-xl mx-1 delay-150">●</span>
    <span class="animate-bounce text-xl mx-1 delay-300">●</span>
  </div>
</div>


      <!-- Feedback Box -->
      <div *ngIf="showFeedbackBox()" class="mt-1 border rounded-lg overflow-hidden bg-gray-100 p-2">
        <!-- Header -->
        <div class="flex justify-between items-center p-1 border-b rounded-t-lg">
          <span class="font-semibold text-black text-xs">Provide Additional Feedback</span>
          <span class="text-[10px] text-#3E71AD-600">Characters {{ feedbackText().length }}/500</span>
        </div>

        <!-- Textarea -->
        <textarea
          [ngModel]="feedbackText()"
          (ngModelChange)="feedbackText.set($event)"
          placeholder="Type here..."
          maxlength="500"
          class="w-full p-2 text-xs border border-gray-300 rounded-lg resize-none focus:outline-black focus:ring-1 focus:ring-black mt-1"
          rows="3"
        ></textarea>

        <!-- Footer -->
<div class="flex justify-end gap-1 p-1 border-t rounded-b-lg mt-1">
  <button
    class="px-2 py-0.5 rounded-full border border-gray-300 text-[#3E71AD] flex items-center gap-0.5 hover:bg-gray-100 text-xs font-medium"
    (click)="showFeedbackBox.set(false)"
  >
    <span class="material-symbols-outlined text-[14px] leading-none">close</span>
    Cancel
  </button>
  <button
    class="px-2 py-0.5 rounded-full bg-[#3E71AD] text-white flex items-center gap-0.5 hover:bg-[#335d8d] text-xs font-medium"
    (click)="submitFeedback()"
  >
    <span class="material-symbols-outlined text-[14px] leading-none">done</span>
    Submit
  </button>
</div>

      </div>
    </div>

    <!-- Input -->
    <div class="border-t border-border p-1 flex gap-1">
      <input
        type="text"
        placeholder="Type Here..."
        class="flex-1 rounded-md border border-border p-1 text-xs"
        [ngModel]="userInput()"
        (ngModelChange)="userInput.set($event)"
        (keydown.enter)="sendMessage()"
      />
      <button
        class="p-0 m-1 border-none bg-transparent text-black hover:scale-110"
        (click)="sendMessage()"
      >
        <span class="material-symbols-outlined text-[16px]">send</span>
      </button>
    </div>
  </div>
</div>
